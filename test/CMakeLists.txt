cmake_minimum_required(VERSION 3.16)

project(mtest, VERSION 0.0.9 LANGUAGES CXX)

include_directories(
  ${CMAKE_SOURCE_DIR}/include
  /usr/local/include
)

link_directories(
  /usr/local/lib
)

link_libraries(
  LLVMXRay
  LLVMWindowsManifest
  LLVMTextAPI
  LLVMTableGen
  LLVMSymbolize
  LLVMDebugInfoPDB
  LLVMOrcJIT
  LLVMOrcError
  LLVMJITLink
  LLVMObjectYAML
  LLVMMCA
  LLVMLTO
  LLVMPasses
  LLVMObjCARCOpts
  LLVMLineEditor
  LLVMLibDriver
  LLVMInterpreter
  LLVMFuzzMutate
  LLVMMCJIT
  LLVMExecutionEngine
  LLVMRuntimeDyld
  LLVMDlltoolDriver
  LLVMOption
  LLVMDebugInfoGSYM
  LLVMCoverage
  LLVMCoroutines
  LLVMXCoreDisassembler
  LLVMXCoreCodeGen
  LLVMXCoreDesc
  LLVMXCoreInfo
  LLVMX86Disassembler
  LLVMX86AsmParser
  LLVMX86CodeGen
  LLVMX86Desc
  LLVMX86Utils
  LLVMX86Info
  LLVMWebAssemblyDisassembler
  LLVMWebAssemblyCodeGen
  LLVMWebAssemblyDesc
  LLVMWebAssemblyAsmParser
  LLVMWebAssemblyInfo
  LLVMSystemZDisassembler
  LLVMSystemZCodeGen
  LLVMSystemZAsmParser
  LLVMSystemZDesc
  LLVMSystemZInfo
  LLVMSparcDisassembler
  LLVMSparcCodeGen
  LLVMSparcAsmParser
  LLVMSparcDesc
  LLVMSparcInfo
  LLVMRISCVDisassembler
  LLVMRISCVCodeGen
  LLVMRISCVAsmParser
  LLVMRISCVDesc
  LLVMRISCVUtils
  LLVMRISCVInfo
  LLVMPowerPCDisassembler
  LLVMPowerPCCodeGen
  LLVMPowerPCAsmParser
  LLVMPowerPCDesc
  LLVMPowerPCInfo
  LLVMNVPTXCodeGen
  LLVMNVPTXDesc
  LLVMNVPTXInfo
  LLVMMSP430Disassembler
  LLVMMSP430CodeGen
  LLVMMSP430AsmParser
  LLVMMSP430Desc
  LLVMMSP430Info
  LLVMMipsDisassembler
  LLVMMipsCodeGen
  LLVMMipsAsmParser
  LLVMMipsDesc
  LLVMMipsInfo
  LLVMLanaiDisassembler
  LLVMLanaiCodeGen
  LLVMLanaiAsmParser
  LLVMLanaiDesc
  LLVMLanaiInfo
  LLVMHexagonDisassembler
  LLVMHexagonCodeGen
  LLVMHexagonAsmParser
  LLVMHexagonDesc
  LLVMHexagonInfo
  LLVMBPFDisassembler
  LLVMBPFCodeGen
  LLVMBPFAsmParser
  LLVMBPFDesc
  LLVMBPFInfo
  LLVMARMDisassembler
  LLVMARMCodeGen
  LLVMARMAsmParser
  LLVMARMDesc
  LLVMARMUtils
  LLVMARMInfo
  LLVMAMDGPUDisassembler
  LLVMAMDGPUCodeGen
  LLVMMIRParser
  LLVMipo
  LLVMInstrumentation
  LLVMVectorize
  LLVMLinker
  LLVMIRReader
  LLVMAsmParser
  LLVMAMDGPUAsmParser
  LLVMAMDGPUDesc
  LLVMAMDGPUUtils
  LLVMAMDGPUInfo
  LLVMAArch64Disassembler
  LLVMMCDisassembler
  LLVMAArch64CodeGen
  LLVMGlobalISel
  LLVMSelectionDAG
  LLVMAsmPrinter
  LLVMDebugInfoDWARF
  LLVMCodeGen
  LLVMTarget
  LLVMScalarOpts
  LLVMInstCombine
  LLVMAggressiveInstCombine
  LLVMTransformUtils
  LLVMBitWriter
  LLVMAnalysis
  LLVMProfileData
  LLVMObject
  LLVMBitReader
  LLVMBitstreamReader
  LLVMCore
  LLVMRemarks
  LLVMAArch64AsmParser
  LLVMMCParser
  LLVMAArch64Desc
  LLVMMC
  LLVMDebugInfoCodeView
  LLVMDebugInfoMSF
  LLVMBinaryFormat
  LLVMAArch64Utils
  LLVMAArch64Info
  LLVMSupport
  LLVMDemangle
  LLVMCFGuard
  z
  curses
  clang
)

add_executable(mtest
  tutil.cc
  test.cc
  test_math.cc
  test_string.cc
  test_array.cc
  test_queue.cc
  test_hashtable.cc
  test_hashset.cc
  test_util.cc
  test_lexer.cc
  test_parser.cc
  test_parser_logical.cc
  test_parser_relational.cc
  test_astdump.cc
  test_analyzer.cc
  test_analyzer_errors.cc
  test_jit_relational.cc
  test_jit_logical.cc
  test_jit.cc
  test_cmodule.cc
)
TARGET_LINK_LIBRARIES(mtest gtest gmock gtest_main mlr)

enable_testing()
include(GoogleTest)
gtest_discover_tests(mtest)
add_custom_command(
  TARGET mtest
  POST_BUILD
  COMMAND mtest
)


